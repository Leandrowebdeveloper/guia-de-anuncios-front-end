<app-header-component></app-header-component>

<ion-content [fullscreen]="true">
  <ion-grid fixed>
    <ion-row *ngIf="categoryAnnouncement$ | async;else Error">
      <!-- Titulo da categoria  -->
      <ion-col size="12">
        <ion-text class="d-flex">
          <ion-icon
            class="ion-margin-end"
            size="large"
            [src]="category?.image
            ? '/images/icons/black/' + category?.image?.filename : './../../../../assets/thumbnail.svg'"
          ></ion-icon>
          <h1
            [title]="category | attrTitle:'name'"
            [attr.data-message]="category | attrTitle:'name'"
            class="align-items"
          >
            {{ category?.name }}
          </h1>
        </ion-text>
      </ion-col>

      <ion-col size="12">
        <!-- List item -->
        <ion-list>
          <ion-reorder-group
            (ionItemReorder)="doReorder($event)"
            [disabled]="!isOrder"
          >
            <ion-reorder *ngFor="let item of announcement">
              <ion-item
                class="ion-no-padding"
                lines="none"
                detail="false"
                color="none"
              >
                <ion-card>
                  <ion-row>
                    <!-- Image -->
                    <ion-col
                      size-xl="2"
                      size-lg="2"
                      size-md="12"
                      size-sm="12"
                      size="12"
                      class="ion-no-padding"
                      [hidden]="item?.galery?.length === 0"
                    >
                      <picture
                        class="cursor-pointer"
                        [routerLink]="['/pagina', item?.slug]"
                        *ngFor="let image of item?.galery"
                      >
                        <source
                          media="(max-width: 575.98px)"
                          [srcset]="'/images/galery/small/' + image?.filename"
                        />
                        <source
                          media="(max-width: 767.98px) and (min-width: 576px)"
                          [srcset]="'/images/galery/small/' + image?.filename"
                        />
                        <source
                          media="(max-width: 991.98px) and (min-width: 768px)"
                          [srcset]="'/images/galery/medium/' + image?.filename"
                        />
                        <source
                          media="(min-width: 992px)"
                          [srcset]="'/images/galery/x-small/' + image?.filename"
                        />
                        <img
                          [src]="'/images/galery/large/' + image?.filename"
                          [title]="item | attrTitle:'title'"
                          [attr.data-message]="item | attrTitle:'title'"
                          [alt]="'Imagem ' + item?.title"
                        />
                      </picture>
                    </ion-col>
                    <!-- Dados do anúncio -->
                    <ion-col
                      size-xl="8"
                      size-lg="8"
                      size-md="8"
                      size-sm="8"
                      size="12"
                      class="ion-no-padding"
                    >
                      <ion-card-header>
                        <ion-card-title
                          [title]="item?.title"
                          [attr.data-message]="item?.title"
                          >{{ item?.title | lnWords }}</ion-card-title
                        >
                        <ion-card-subtitle>
                          <address
                            [title]="item | attrTitle:'citie'"
                            [attr.data-message]="item | attrTitle:'citie'"
                          >
                            {{ item?.citie | citie }}
                          </address>
                        </ion-card-subtitle>
                        <ion-card-subtitle
                          ><address
                            [title]="item | attrTitle:'address'"
                            [attr.data-message]="item | attrTitle:'address'"
                          >
                            {{ item?.address | address }}
                          </address></ion-card-subtitle
                        >
                        <ion-card-subtitle [hidden]="!item?.workDays">
                          <ion-text
                            [color]="
                          (item?.workDays | workDays) === 'Aberto'
                            ? 'success'
                            : 'danger'
                        "
                            class="ion-hide-xl-up ion-hide-lg-up"
                            [title]="item | attrTitle:'workDays'"
                            [attr.data-message]="item | attrTitle:'workDays'"
                          >
                            {{ item?.workDays | workDays }}
                          </ion-text>
                        </ion-card-subtitle>
                      </ion-card-header>
                    </ion-col>
                    <!-- Item com imagens -->
                    <ion-col
                      size-xl="2"
                      size-lg="2"
                      size-md="4"
                      size-sm="4"
                      size="12"
                      class="ion-no-padding"
                      [hidden]="item?.galery?.length === 0"
                    >
                      <ion-card-content>
                        <ion-text
                          [color]="
                        (item?.workDays | workDays) === 'Aberto'
                          ? 'success'
                          : 'danger'
                      "
                          class="ion-text-center ion-hide-lg-down"
                        >
                          <p
                            [title]="item | attrTitle:'workDays'"
                            [attr.data-message]="item | attrTitle:'workDays'"
                          >
                            {{ item?.workDays | workDays }}
                          </p>
                        </ion-text>
                        <ion-button
                          shape="round"
                          [routerLink]="['/pagina', item?.slug]"
                          [title]="item | attrTitle:'title'"
                          [attr.data-message]="item | attrTitle:'title'"
                        >
                          Ver página
                        </ion-button>
                      </ion-card-content>
                    </ion-col>
                    <!-- Item sem imagens -->
                    <ion-col
                      size-xl="4"
                      size-lg="4"
                      size-md="4"
                      size-sm="4"
                      size="12"
                      class="ion-no-padding"
                      [hidden]="item?.galery?.length !== 0"
                    >
                      <ion-card-content
                        class="ion-float-xl-end ion-float-lg-end ion-float-md-end ion-float-sm-none ion-float-none"
                      >
                        <ion-text
                          [color]="
                        (item?.workDays | workDays) === 'Aberto'
                          ? 'success'
                          : 'danger'
                      "
                          class="ion-text-center ion-hide-lg-down"
                        >
                          <p
                            [hidden]="!item?.workDays"
                            [title]="item | attrTitle:'workDays'"
                            [attr.data-message]="item | attrTitle:'workDays'"
                          >
                            {{ item?.workDays | workDays }}
                          </p>
                        </ion-text>
                        <ion-button
                          shape="round"
                          [routerLink]="['/pagina', item?.slug]"
                          [title]="item | attrTitle:'title'"
                          [attr.data-message]="item | attrTitle:'title'"
                        >
                          Ver página
                        </ion-button>
                      </ion-card-content>
                    </ion-col>
                  </ion-row>
                </ion-card>
                <ion-icon
                  [hidden]="!isOrder"
                  name="reorder-three"
                  color="medium"
                ></ion-icon>
              </ion-item>
            </ion-reorder>
          </ion-reorder-group>
        </ion-list>
      </ion-col>

      <ion-card *ngIf="!endListCategory">
        <ion-text color="primary" class="ion-text-center">
          <p>FIM</p>
          <p>{{ announcement?.length }} Anúncios</p>
        </ion-text>
      </ion-card>
      <ion-infinite-scroll
        (ionInfinite)="findMoreCategory($event)"
        *ngIf="endListCategory"
      >
        <ion-infinite-scroll-content
          loadingSpinner="bubbles"
          loadingText="Carregando mais dados…"
        >
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </ion-row>

    <ng-template #Error>
      <ng-container *ngIf="error | async; else loadingNoError">
        <ion-row>
          <ion-col size="12">
            <div class="content-center">
              <div>
                <ion-text class="ion-text-center">
                  <p [ngClass]="{ hide: menssage }">
                    Erro ao carregar anúncios.
                  </p>
                </ion-text>
                <ion-refresher slot="fixed" (ionRefresh)="refresher($event)">
                  <ion-refresher-content
                    pullingIcon="chevron-down-circle-outline"
                    pullingText="Puxe para baixo"
                    refreshingSpinner="circles"
                    refreshingText="Atualizar..."
                  >
                  </ion-refresher-content>
                </ion-refresher>
                <ion-text class="ion-text-center">
                  <ion-button (mousedown)="hideMenssage()"
                    >Puxe para atualizar
                    <ion-icon
                      class="ion-margin-start"
                      name="arrow-down-circle"
                    ></ion-icon>
                  </ion-button>
                </ion-text>
              </div>
            </div>
          </ion-col>
        </ion-row>
      </ng-container>

      <ng-template #loadingNoError>
        <ion-row class="ion-margin-horizontal">
          <ion-col size="12" class="ion-margin-vertical">
            <span class="header">
              <ion-skeleton-text animated class="icons"></ion-skeleton-text>
              <ion-skeleton-text animated class="title"></ion-skeleton-text>
            </span>
          </ion-col>
          <ion-col size="12">
            <span *ngFor="let item of sizeSkeleton">
              <div class="cards">
                <ion-skeleton-text animated class="image"></ion-skeleton-text>
                <div>
                  <div class="item_cards">
                    <ion-skeleton-text
                      animated
                      class="title"
                    ></ion-skeleton-text>
                    <ion-skeleton-text
                      animated
                      class="address"
                    ></ion-skeleton-text>
                    <ion-skeleton-text
                      animated
                      class="address_2"
                    ></ion-skeleton-text>
                  </div>
                  <div class="item_cards_btn">
                    <ion-skeleton-text animated class="btn"></ion-skeleton-text>
                  </div>
                </div>
              </div>
            </span>
          </ion-col>
        </ion-row>
      </ng-template>
    </ng-template>

    <!-- Salvar ordenação -->
    <ion-fab
      vertical="bottom"
      horizontal="center"
      slot="fixed"
      title="Salvar ordem da lista de anúncios"
      data-message="Salvar ordem da lista de anúncios"
    >
      <ion-fab-button
        [hidden]="!sendOrder"
        color="primary"
        (click)="saveOrder()"
        ><ion-icon name="save" color="light"></ion-icon>
      </ion-fab-button>
    </ion-fab>

    <!-- Ordenar -->
    <ion-fab
      *ngIf="isBtnOrder && error"
      vertical="center"
      horizontal="end"
      slot="fixed"
      title="Ordenar anúncios"
      data-message="Ordenar categoria"
    >
      <ion-fab-button size="small">
        <ion-icon name="ellipsis-vertical"></ion-icon>
      </ion-fab-button>
      <ion-fab-list side="top">
        <ion-fab-button
          color="primary"
          title="Ordenar categorias"
          data-message="Ordenar categorias"
          (click)="orderList()"
        >
          <ion-icon name="reorder-four"></ion-icon>
        </ion-fab-button>
      </ion-fab-list>
    </ion-fab>
  </ion-grid>
</ion-content>

<app-footer></app-footer>
