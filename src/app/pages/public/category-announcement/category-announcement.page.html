<app-header-component></app-header-component>

<ion-content [fullscreen]="true">
  <ion-grid fixed *ngIf="categoryAnnouncement$ | async;else Error">
    <ion-row>
      <!-- Titulo da categoria  -->
      <ion-col size="12">
        <ion-text>
          <h1
            [title]="category | attrTitle:'name'"
            [attr.data-message]="category | attrTitle:'name'"
            class="align-items"
          >
            <ion-icon
              class="ion-margin-end"
              size="large"
              [src]="category?.image?.url || './../../../../assets/thumbnail.svg'"
            ></ion-icon>
            {{ category?.name }}
          </h1>
        </ion-text>
      </ion-col>

      <ion-col size="12">
        <!-- List item -->
        <ion-list>
          <ion-reorder-group
            (ionItemReorder)="doReorder($event)"
            [disabled]="!isOrder"
          >
            <ion-reorder *ngFor="let item of announcement">
              <ion-item
                class="ion-no-padding"
                lines="none"
                detail="false"
                color="none"
              >
                <ion-card>
                  <ion-row>
                    <ion-col
                      size-xl="2"
                      size-lg="2"
                      size-md="12"
                      size-sm="12"
                      size="12"
                      class="ion-no-padding"
                      [hidden]="item?.galery?.length === 0"
                    >
                      <ion-thumbnail
                        *ngFor="let image of item?.galery"
                        class="cursor-pointer"
                        [routerLink]="['/pagina', item?.slug]"
                      >
                        <img
                          [title]="item | attrTitle:'title'"
                          [attr.data-message]="item | attrTitle:'title'"
                          [alt]="'Imagem ' + item?.title"
                          [src]="'/images/galery/x-small/' + image?.filename"
                        />
                      </ion-thumbnail>
                    </ion-col>

                    <ion-col
                      size-xl="8"
                      size-lg="8"
                      size-md="8"
                      size-sm="8"
                      size="12"
                      class="ion-no-padding"
                    >
                      <ion-card-header>
                        <ion-card-title
                          [title]="item?.title"
                          [attr.data-message]="item?.title"
                          >{{ item?.title | lnWords }}</ion-card-title
                        >
                        <ion-card-subtitle>
                          <address
                            [title]="item | attrTitle:'citie'"
                            [attr.data-message]="item | attrTitle:'citie'"
                          >
                            {{ item?.citie | citie }}
                          </address>
                        </ion-card-subtitle>
                        <ion-card-subtitle
                          ><address
                            [title]="item | attrTitle:'address'"
                            [attr.data-message]="item | attrTitle:'address'"
                          >
                            {{ item?.address | address }}
                          </address></ion-card-subtitle
                        >
                        <ion-card-subtitle [hidden]="!item?.workDays">
                          <ion-text
                            [color]="
                          (item?.workDays | workDays) === 'Aberto'
                            ? 'success'
                            : 'danger'
                        "
                            class="ion-hide-xl-up ion-hide-lg-up"
                            [title]="item | attrTitle:'workDays'"
                            [attr.data-message]="item | attrTitle:'workDays'"
                          >
                            {{ item?.workDays | workDays }}
                          </ion-text>
                        </ion-card-subtitle>
                      </ion-card-header>
                    </ion-col>

                    <ion-col
                      size-xl="2"
                      size-lg="2"
                      size-md="4"
                      size-sm="4"
                      size="12"
                      class="ion-no-padding"
                      [hidden]="item?.galery?.length === 0"
                    >
                      <ion-card-content>
                        <ion-text
                          [color]="
                        (item?.workDays | workDays) === 'Aberto'
                          ? 'success'
                          : 'danger'
                      "
                          class="ion-text-center ion-hide-lg-down"
                        >
                          <p
                            [title]="item | attrTitle:'workDays'"
                            [attr.data-message]="item | attrTitle:'workDays'"
                          >
                            {{ item?.workDays | workDays }}
                          </p>
                        </ion-text>
                        <ng-container
                          *ngIf="item?.plan?.type === 'free'; else Buttom"
                        >
                          <app-show-contact-announcement-component
                            [announcement]="item"
                          ></app-show-contact-announcement-component>
                        </ng-container>

                        <ng-template #Buttom>
                          <ion-button
                            shape="round"
                            [routerLink]="['/pagina', item?.slug]"
                            [title]="item | attrTitle:'title'"
                            [attr.data-message]="item | attrTitle:'title'"
                          >
                            Ver página
                          </ion-button>
                        </ng-template>
                      </ion-card-content>
                    </ion-col>

                    <ion-col
                      size-xl="4"
                      size-lg="4"
                      size-md="4"
                      size-sm="4"
                      size="12"
                      class="ion-no-padding"
                      [hidden]="item?.galery?.length !== 0"
                    >
                      <ion-card-content
                        class="ion-float-xl-end ion-float-lg-end ion-float-md-end ion-float-sm-none ion-float-none"
                      >
                        <ion-text
                          [color]="
                        (item?.workDays | workDays) === 'Aberto'
                          ? 'success'
                          : 'danger'
                      "
                          class="ion-text-center ion-hide-lg-down"
                        >
                          <p
                            [hidden]="!item?.workDays"
                            [title]="item | attrTitle:'workDays'"
                            [attr.data-message]="item | attrTitle:'workDays'"
                          >
                            {{ item?.workDays | workDays }}
                          </p>
                        </ion-text>
                        <ng-container
                          *ngIf="item?.plan?.type === 'free'; else Buttom"
                        >
                          <app-show-contact-announcement-component
                            [announcement]="item"
                          ></app-show-contact-announcement-component>
                        </ng-container>

                        <ng-template #Buttom>
                          <ion-button
                            shape="round"
                            [routerLink]="['/pagina', item?.slug]"
                            [title]="item | attrTitle:'title'"
                            [attr.data-message]="item | attrTitle:'title'"
                          >
                            Ver página
                          </ion-button>
                        </ng-template>
                      </ion-card-content>
                    </ion-col>
                  </ion-row>
                </ion-card>
                <ion-icon
                  [hidden]="!isOrder"
                  name="reorder-three"
                  color="medium"
                ></ion-icon>
              </ion-item>
            </ion-reorder>
          </ion-reorder-group>
        </ion-list>
      </ion-col>
    </ion-row>

    <ion-card *ngIf="!endListCategory">
      <ion-text color="primary" class="ion-text-center">
        <p>FIM</p>
        <p>{{ announcement?.length }} Anúncios</p>
      </ion-text>
    </ion-card>

    <ion-infinite-scroll
      (ionInfinite)="findMoreCategory($event)"
      *ngIf="endListCategory"
    >
      <ion-infinite-scroll-content
        loadingSpinner="bubbles"
        loadingText="Carregando mais dados…"
      >
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </ion-grid>

  <ng-template #Error>
    <ng-container *ngIf="error | async; else loadingNoError">
      <ion-row>
        <ion-col size="12">
          <div class="content-center">
            <div>
              <ion-text class="ion-text-center">
                <p [ngClass]="{ hide: menssage }">Erro ao carregar anúncios.</p>
              </ion-text>
              <ion-refresher slot="fixed" (ionRefresh)="refresher($event)">
                <ion-refresher-content
                  pullingIcon="chevron-down-circle-outline"
                  pullingText="Puxe para baixo"
                  refreshingSpinner="circles"
                  refreshingText="Atualizar..."
                >
                </ion-refresher-content>
              </ion-refresher>
              <ion-text class="ion-text-center">
                <ion-button (mousedown)="hideMenssage()"
                  >Puxe para atualizar
                  <ion-icon
                    class="ion-margin-start"
                    name="arrow-down-circle"
                  ></ion-icon>
                </ion-button>
              </ion-text>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ng-container>

    <ng-template #loadingNoError>
      <span size="12" class="ion-padding-bottom ion-padding-horizontal">
        <ion-skeleton-text animated class="search"></ion-skeleton-text>
      </span>
      <span *ngFor="let item of sizeSkeleton">
        <div class="skeleton">
          <ion-skeleton-text animated class="avatar"></ion-skeleton-text>
          <div>
            <ion-skeleton-text animated class="title"></ion-skeleton-text>
            <ion-skeleton-text animated class="line"></ion-skeleton-text>
          </div>
        </div>
      </span>
    </ng-template>
  </ng-template>

  <!-- Salvar ordenação -->
  <ion-fab
    vertical="bottom"
    horizontal="center"
    slot="fixed"
    title="Salvar ordem da lista de anúncios"
    data-message="Salvar ordem da lista de anúncios"
  >
    <ion-fab-button [hidden]="!sendOrder" color="primary" (click)="saveOrder()"
      ><ion-icon name="save" color="light"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Ordenar -->
  <ion-fab
    *ngIf="isBtnOrder && error"
    vertical="center"
    horizontal="end"
    slot="fixed"
    title="Ordenar anúncios"
    data-message="Ordenar categoria"
  >
    <ion-fab-button size="small">
      <ion-icon name="ellipsis-vertical"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
      <ion-fab-button
        color="primary"
        title="Ordenar categorias"
        data-message="Ordenar categorias"
        (click)="orderList()"
      >
        <ion-icon name="reorder-four"></ion-icon>
      </ion-fab-button>
    </ion-fab-list>
  </ion-fab>
</ion-content>

<app-footer></app-footer>
